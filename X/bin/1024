#!/bin/bash

shopt -s extglob
shopt -s nullglob

cmd=${0##*/}
wid=$(xdotool getactivewindow)
name=$(xdotool getwindowname $wid)
class_=$(xprop -id $wid WM_CLASS)
class=$(awk -F\" '{print $4}' <<<"$class_")
classname=$(awk -F\" '{print $2}' <<<"$class_")
screenx=$(xwininfo -root | awk '$1=="Width:"{print $2}')
screeny=$(xwininfo -root | awk '$1=="Height:"{print $2}')

resize() {
    declare wid=$1 x=$2 y=$3

    # Get the frame widths to subtract from the requested size.
    # frame=( left right top bottom )
    declare frame=( \
        $(xprop -notype -id $wid _NET_FRAME_EXTENTS | \
        grep -o '[0-9]\+') )

    # If x/y are given in absolute pixels then subtract.
    if [[ $x != *[!0-9]* ]]; then
        x=$((x - frame[0] - frame[1]))
    fi
    if [[ $y != *[!0-9]* ]]; then
        y=$((y - frame[2] - frame[3]))
    fi

    # Do this thing already
    xdotool windowsize $wid $x $y
}

case $cmd in
    1024)
        resize $wid 1024 y
        ;;
    div)
        case $1 in
            */*) resize $wid $((screenx * $1)) y ;;
            *)  resize $wid $((screenx / $1)) y ;;
        esac
        ;;
    xsetsize)
        resize $wid ${1/x/ } "${@:2}"
        ;;
    *)
        echo "Unknown cmd: $cmd"
        exit 1
        ;;
esac
