#!/bin/bash

[[ $PWD == / ]] && cd
[[ -r ~/.run_term ]] && source ~/.run_term
: ${RUN_TERM:=xterm}

unset xprops
xlookup() {
    # $xprops is cached globally
    [[ -n $xprops ]] || xprops=$(echo -e "$(xrdb -query)")

    declare reply
    reply=$(awk -v "key=$1" '
        $1==key":" {sub("[^:]*:[[:blank:]]*", ""); print; exit}
        ' <<<"$xprops")

    [[ -n $reply ]] && echo "$reply"
    return $?
}

run_gnome_terminal() {
    declare x
    # change -e to -x for gnome-terminal
    for ((x=1; x<=$#; x++)); do
        if [[ ${!x} == -e ]]; then
            set -- "${@:1:x-1}" -x "${@:x+1}"
            break
        fi
    done
    declare geom=$(xlookup "XTerm.vt100.geometry")
    exec $RUN_TERM ${geom:+--geometry $geom} "$@"
}

run_roxterm() {
    declare geom=$(xlookup "XTerm.vt100.geometry")
    exec $RUN_TERM ${geom:+--geometry $geom} "$@"
}

case $RUN_TERM in
    gnome-terminal*) run_gnome_terminal "$@" ;;
    roxterm)         run_roxterm "$@" ;;
    *)               exec $RUN_TERM "$@" ;;
esac
