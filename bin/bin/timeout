#!/bin/bash
#
# timeout compatibility wrapper between the old tct version and the new
# coreutils version

set -e

timeout=$(wrapped "$0")

if [[ $1 == -[0-9]* ]]; then
    sig=${1#-}
    shift
elif [[ $1 == -s[0-9]* ]]; then
    sig=${1#-s}
    shift
elif [[ $1 == -s && $2 == [0-9]* ]]; then
    sig=$2
    shift 2
else
    exec "$timeout" "$@"
fi

v=$("$timeout" --version 2>&1) || true

if [[ $v == *coreutils* ]]; then
    exec "$timeout" -s "$sig" "$@"
else
    exec "$timeout" -"$sig" "$@"
fi
