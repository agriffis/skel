#!/bin/bash

TT=$HOME/Dropbox/tt.txt

last() {
    tail -n1 $TT
}

darg=()
if [[ $1 == *:* ]]; then
    darg=( -d "$1" )
elif [[ -n $1 && $1 != *[!0-9]* ]]; then
    darg=( -d "$1 minutes ago" )
elif [[ $1 == e ]]; then
    exec vim $TT
elif [[ $1 == l ]]; then
    last; exit
elif [[ $1 == r ]]; then
    sed -i '$d' $TT
    last; exit
elif [[ -n $1 ]]; then
    echo "I don't understand: $*" >&2
    exit 1
fi

action=START
if [[ $(last) == START* ]]; then
    action=STOP
fi

printf '%s %s\n' "$action" "$(date "${darg[@]}" +%Y%m%d-%H%M%S)" | tee -a $TT
