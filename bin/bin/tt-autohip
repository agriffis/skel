#!/usr/bin/env python3

import datetime
import subprocess

last = subprocess.check_output(['tt', 'l'], universal_newlines=True)
action, stamp = last.strip().split()

if action == 'STOP':
    then = datetime.datetime.strptime(stamp, '%Y%m%d-%H%M%S')
    now = datetime.datetime.now()
    delta = now - then

    if delta.days:
        status = '{}d'.format(delta.days)
    else:
        status = ('{:.0f}h'.format(delta.seconds / 3600)
                  if delta.seconds >= 3600 else
                  '{:.0f}m'.format(delta.seconds / 60))

    subprocess.check_call(['tt-hip', 'away', status])
