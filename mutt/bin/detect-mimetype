#!/usr/bin/perl -w
# 
# detect-mimetime -- figure out mimetype for a file based on extension
#
# Copyright 2009 Aron Griffis <agriffis@n01se.net>
# Released under the GNU General Public License v2

use strict;

my $filename = $ARGV[0];
my @dbs = (
    $ENV{'HOME'}."/.mime.types",
    "/etc/mime.types"
);
my %types = ();
for my $db (@dbs) {
    open F, "<$db" or next;
    while (<F>) {
        next unless /^([^\s#]\S+)\s+(\S.*)/;
        for (split " ", $2) { $types{$_} ||= $1; }
    }
}
while (1) {
    if ($types{$filename}) {
        print $types{$filename}."\n";
        exit 0;
    }
    last unless $filename =~ s/^[^\.]*\.//;
}
exit 1;
