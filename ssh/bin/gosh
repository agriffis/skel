#!/bin/bash

gateway=pvd.scampersand.com

ssh-add -l &>/dev/null
if [[ $? == 2 ]]; then
  exec ssh-agent "$(type -P "$0")" "$@"
fi

ssh-add -l &>/dev/null
if [[ $? != 0 ]]; then
  ssh-add || exit
fi

ssh -fA $gateway 'ln -sfn $SSH_AUTH_SOCK foo; sleep 30'
case /$0 in
    */gosh) mosh $gateway -- env SSH_AUTH_SOCK=foo ssh -t "$@" ;;
    */sssh) ssh -t $gateway -- env SSH_AUTH_SOCK=foo ssh -t "$@" ;;
    *) echo "what is $0?" >&2; exit 1 ;;
esac
