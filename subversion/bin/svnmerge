#!/bin/bash

if [[ -z $1 ]]; then
    set -- .
fi

set -e -x

for x; do (
    cd "$x"
    [[ $PWD == */branches/* && $PWD != */branches/*/* ]]
    url=$(svn info | awk '/^URL:/{print $NF}')
    trunk=${url%/branches/*}/trunk
    rev=$(svn info $trunk | awk '/^Last Changed Rev:/{print $NF}')
    svn merge $trunk
    set +x
    echo
    echo "svn ci -m \"Merge up to trunk r$rev\" ."
    echo
); done
